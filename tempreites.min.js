/*! tempreites - v0.1.3 - 2014-01-22\n* Copyright (c) 2014 ; Licensed MIT */!function(a,b){"use strict";"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(function(){return b()}):a.Tempreites=b()}(this,function(){function a(a){var b=a.readRegex(o),c=null;if("="===a.current||"="===a.peekIgnoreWhitespace()){a.readRegex(/\s*=\s*/);var d=/['"]/.test(a.current)?a.current:"",e=d?new RegExp(d+"(.*?)"+d):/(.*?)(?=[\s>])/,f=e.exec(a.substring)||[0,""];c=f[1],a.read(f[0].length)}a.callbacks.attribute(b,c)}function b(b,c){function d(){return c?"?"===b.current&&">"===b.peek():">"===b.current||"/"===b.current&&">"===b.peekIgnoreWhitespace()}for(var e=b.current;!b.isEof()&&!d();)o.test(e)?(a(b),e=b.current):e=b.read()}function c(a,b){var c,d={area:!0,base:!0,basefont:!0,br:!0,col:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,link:!0,meta:!0,param:!0,embed:!0};b in d&&(c=!0),"/"===a.current?(a.readUntilNonWhitespace(),a.read(),a.callbacks.closeOpenedElement(b,"/>",c)):"?"===a.current?(a.read(2),a.callbacks.closeOpenedElement(b,"?>",c)):(a.read(),a.callbacks.closeOpenedElement(b,">",c))}function d(a){var d=a.readRegex(o);if(a.callbacks.openElement(d),b(a,!1),c(a,d),/^(script|xmp)$/i.test(d)){var e=new RegExp("^([\\s\\S]*?)(?:$|</("+d+")\\s*>)","i"),f=e.exec(a.substring);a.read(f[0].length),f[1]&&a.callbacks.cdata(f[1]),f[2]&&a.callbacks.closeElement(f[2])}}function e(a){var b=a.readRegex(o);a.callbacks.closeElement(b),a.readRegex(/.*?(?:>|$)/)}function f(a){a.read(8);var b=/^([\s\S]*?)(?:$|]]>)/.exec(a.substring),c=b[1];a.read(b[0].length),a.callbacks.cdata(c)}function g(a){a.read(3);var b=/^([\s\S]*?)(?:$|-->)/.exec(a.substring),c=b[1];a.read(b[0].length),a.callbacks.comment(c)}function h(a){a.read(8);var b=/^\s*([\s\S]*?)(?:$|>)/.exec(a.substring),c=b[1];a.read(b[0].length),a.callbacks.docType(c)}function i(a){a.read(4),a.callbacks.xmlProlog(),b(a,!0),c(a,"?xml")}function j(a,b){b.text+=a}function k(a){a.text&&(a.callbacks.text(a.text),a.text="")}function l(a){var b=a.current,c=b;"<"==b?(c+=a.read(),"/"===a.current?(c+=a.read(),o.test(a.current)?(k(a),e(a)):(a.read(),j(c,a))):"!"===a.current?/^!\[CDATA\[/.test(a.substring)?(k(a),f(a)):/^!--/.test(a.substring)?(k(a),g(a)):/^!doctype/i.test(a.substring)?(k(a),h(a)):(a.read(),j(c,a)):"?"===a.current?/^\?xml/.test(a.substring)?(k(a),i(a)):(a.read(),j(c,a)):o.test(a.current)?(k(a),d(a)):(a.read(),j(c,a))):(j(a.current,a),a.read())}function m(a){function b(){}return b.prototype=a,new b}var n={create:function(a,b){var c=0,d={text:"",peek:function(a){return a=a||1,this.raw.substr(c+1,a)},read:function(a){if(0===a)return"";a=a||1;var b=this.peek(a);return c+=a,c>this.length&&(c=this.length),b},readUntilNonWhitespace:function(){for(var a,b="";!this.isEof()&&(a=this.read(),b+=a,/\s$/.test(b)););return b},isEof:function(){return c>=this.length},readRegex:function(a){var b=(a.exec(this.raw.substring(this.index))||[""])[0];return c+=b.length,b},peekIgnoreWhitespace:function(a){a=a||1;var b="",c="",d=0;do{if(c=this.raw.charAt(this.index+ ++d),!c)break;/\s/.test(c)||(b+=c)}while(b.length<a);return b}};d.__defineGetter__("current",function(){return this.isEof()?"":this.raw.charAt(this.index)}),d.__defineGetter__("raw",function(){return a}),d.__defineGetter__("length",function(){return this.raw.length}),d.__defineGetter__("index",function(){return c}),d.__defineGetter__("substring",function(){return this.raw.substring(this.index)}),d.callbacks={};var e=["openElement","closeElement","attribute","comment","cdata","text","docType","xmlProlog","closeOpenedElement"];return e.forEach(function(a){d.callbacks[a]=b[a]||function(){}}),d}},o=/[a-zA-Z_][\w:-]*/,p=function(a,b){a=a.replace(/\r\n/g,"\n").replace(/\r/g,"\n");var c=n.create(a,b);do l(c);while(!c.isEof());k(c)};Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});var q=function(a){return a.replace?a.replace(/(<|>|"|'|&)/g,""):a},r=function(a,b){var c="",d=[];if(a.sonsRefs){for(var e=0;e<a.sonsRefs.length;e++)if(b[a.sonsRefs[e]]&&"object"==typeof b[a.sonsRefs[e]]){if(Array.isArray(b[a.sonsRefs[e]]))for(var f=0;f<b[a.sonsRefs[e]].length;f++)for(var g=0;g<a.sons.length;g++){var h=a.sons[g];d.push(r(h,b[a.sonsRefs[e]][f]))}else for(var i=b[a.sonsRefs[e]],g=0;g<a.sons.length;g++){var h=a.sons[g];d.push(r(h,i))}break}}else for(var g=0;g<a.sons.length;g++){var h=a.sons[g];d.push(r(h,b))}for(var j=a.content,e=0;e<a.contentRefs.length;e++)if("string"==typeof b[a.contentRefs[e]]||"number"==typeof b[a.contentRefs[e]]){j=b[a.contentRefs[e]];break}var k=m(a.attrs);a.dataAttrRef&&a.dataAttrRef.dataKey&&a.dataAttrRef.htmlAttr&&("string"==typeof b[a.dataAttrRef.dataKey]||"number"==typeof b[a.dataAttrRef.dataKey])&&(k[a.dataAttrRef.htmlAttr]=q(b[a.dataAttrRef.dataKey]));var l=[];for(var n in k)l.push(k[n]?n+'="'+k[n]+'"':n);var o=l.join(" ");if(o&&(o=" "+o),!a.dataShowRef||a.dataShowRef&&b[a.dataShowRef]){var p=a.open+o+a.close+j+d.join(" ")+a.end+"\n";c+=p}return c};return{render:function(a,b){var c=this.compile(a);return c.render(b)},compile:function(a){var b=[],c=[];p(a,{docType:function(a){var b={};b[a]=null;var d={tag:"",open:"<!doctype",close:">",sons:[],end:" ",attrs:b,content:"",sonsRefs:[],contentRefs:[]};c.push(d)},openElement:function(a){var c={tag:a,open:"<"+a,attrs:{},dataAttrRef:{},dataShowRef:null,content:"",contentRefs:[],sonsRefs:[],end:"",sons:[]};b.push(c)},attribute:function(a,c){var d=b.slice(-1)[0];if("data-bind-here"===a&&(d.dataAttrRef.htmlAttr=c),"data-bind-there"===a&&(d.dataAttrRef.dataKey=c),"data-show-if"===a&&(d.dataShowRef=c),"class"===a)for(var e=c.split(),f=0;f<e.length;f++)e[f]&&(d.contentRefs.push(e[f]),d.sonsRefs.push(e[f]));"id"===a&&(d.contentRefs.unshift(c),d.sonsRefs.unshift(c)),d.attrs[a]=c},closeOpenedElement:function(a,d,e){var f=b.slice(-1)[0];if(f.close=d,e){f.end=" ";var g=b.slice(-2,-1)[0];g?g.sons.push(f):c.push(f);var h=b.pop();b.length||c.push(h)}},text:function(a){var d=b.slice(-1)[0],e={tag:"",open:" ",close:" ",sons:[],end:" ",attrs:{},content:a,sonsRefs:[],contentRefs:[]};d?d.sons.push(e):c.push(e)},cdata:function(a){var c=b.slice(-1)[0];c.content=a},closeElement:function(a){var d=b.slice(-1)[0];if(d.tag!==a)throw new Error("Error matching end tag with previously opened element.\nopened element: "+d.tag+"\nclosing tag: "+a+"\n");d.end="</"+a+">";var e=b.slice(-2,-1)[0];e&&e.sons.push(d);var f=b.pop();b.length||c.push(f)}});var d={elements:c,render:function(a){a=a||{};for(var b="",c=0;c<this.elements.length;c++)b+=r(this.elements[c],a);return b}};return d}}});